:root{
  --blue:#0d2d5c;
  --wood1:#a57a54;
  --wood2:#d3a574;
  --cell-a:#e7cfa6;
  --cell-b:#b88f5a;
  --hi:#84caff;
  --legal:#93e79e;
  --danger:#ff9ba2;
  --ink:#1b1f23;
  --panel:#ffffff;
  --shadow: 0 8px 24px rgba(0,0,0,.12);
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Khmer", Arial, sans-serif;
  color:var(--ink);
  background:#f5f6f7;
}

/* App wrapper (fullscreen target) */
.app{ min-height:100dvh; display:flex; flex-direction:column }

/* Top bar */
.topbar{
  position:sticky;top:0;z-index:20;
  background:var(--blue); color:#fff;
  display:flex; align-items:center; gap:.5rem;
  padding:.75rem 1rem;
  transition: transform .25s ease, opacity .25s ease;
}
.topbar h1{font-size:1.1rem; margin:0}
.icon-btn{
  background:#fff; color:var(--blue); border:none; border-radius:.75rem;
  padding:.4rem .7rem; font-weight:600; cursor:pointer;
}
.icon-btn:active{transform:translateY(1px)}
.topbar .spacer{flex:1}

/* Hide effect when autohide is active */
.app.fs-autohide .topbar{ transform: translateY(-100%); opacity:0 }

/* Layout */
.layout{
  display:grid;
  grid-template-columns: 1fr 320px;
  gap:1rem;
  padding:1rem;
  flex:1;
}
.panel{
  background:var(--panel); border-radius:1rem; box-shadow:var(--shadow);
  padding:1rem;
}
.board-panel{display:flex; flex-direction:column; align-items:center; gap:1rem}

/* Timers */
.timers{ width: min(90vw, 520px); }
.player-row{
  display:flex; align-items:center; justify-content:space-between;
  background:#fff; border:1px solid #e6e6e6; border-radius:.6rem;
  padding:.4rem .7rem; box-shadow: var(--shadow);
}
.player-name{ font-weight:700 }
.clock{
  font-variant-numeric: tabular-nums;
  font-weight:800; letter-spacing:.5px;
  padding:.2rem .5rem; border-radius:.4rem;
  background:#0b1220; color:#e6f0ff;
}

/* Board */
.board{
  width:min(90vw, 520px);
  aspect-ratio:1/1;
  border-radius:.75rem; overflow:hidden;
  background:
    radial-gradient(120% 80% at 20% 10%, rgba(255,255,255,.2), transparent 40%),
    linear-gradient(45deg, rgba(255,255,255,.08), transparent 60%),
    repeating-linear-gradient(90deg, var(--wood1), var(--wood1) 12px, var(--wood2) 12px, var(--wood2) 24px);
  display:grid;
  grid-template-columns: repeat(8, 1fr);
  grid-template-rows: repeat(8, 1fr);
  box-shadow: inset 0 0 0 2px rgba(0,0,0,.1);
}
.cell{
  position:relative;
  display:flex; align-items:center; justify-content:center;
  user-select:none; -webkit-user-select:none;
}
.cell.dark{ background-color: var(--cell-b); }
.cell.light{ background-color: var(--cell-a); }
.cell::after{
  content: attr(data-ax);
  position:absolute; bottom:4px; right:6px;
  font-size:.62rem; opacity:.55;
}

/* Pieces (PNG background) */
.piece{
  width:86%; height:86%;
  background-size:contain; background-repeat:no-repeat; background-position:center;
  border-radius:.4rem; cursor:grab; touch-action:none;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  transition: transform .08s ease;
}
.piece:active{transform:scale(.98)}

/* Hints */
.cell.hint-move::before{
  content:""; position:absolute; width:24%; height:24%;
  background:var(--legal); border-radius:50%; opacity:.8;
}
.cell.hint-capture{ outline: 3px solid var(--danger); }
.cell.selected{ outline: 3px solid var(--hi); z-index:1; }

/* Controls */
.controls{display:flex; align-items:center; gap:.5rem; flex-wrap:wrap}
.primary, .secondary{
  padding:.55rem .8rem; border-radius:.6rem; border:none; cursor:pointer; font-weight:600;
}
.primary{ background:var(--blue); color:#fff}
.secondary{ background:#e7edf6;}
.turn{margin-left:auto; font-weight:600}

/* Move list */
.side-panel h2{margin:.2rem 0 .5rem 0; font-size:1rem}
.moves{margin:0; padding-left:1.2rem; max-height:320px; overflow:auto}
.opt{display:flex; align-items:center; gap:.5rem; margin:.4rem 0}
.note{
  background:#f3f7ff; border-left:4px solid var(--blue);
  padding:.6rem .8rem; border-radius:.4rem; margin-top:1rem; font-size:.92rem;
}

/* Modal */
.modal{ position:fixed; inset:0; display:none; }
.modal.show{ display:block; }
.modal-backdrop{
  position:absolute; inset:0; background:rgba(0,0,0,.4);
}
.modal-card{
  position:relative; z-index:30;
  margin:5vh auto 0 auto; max-width:560px; background:#fff;
  border-radius:1rem; box-shadow:var(--shadow); padding:0;
}
.modal-header{
  display:flex; align-items:center; gap:.5rem; padding:.8rem 1rem;
  border-bottom:1px solid #eee;
}
.modal-header h3{ margin:0 }
.modal-body{ padding:1rem }
.form-row{ display:flex; flex-direction:column; gap:.35rem; margin-bottom:.8rem }
.form-row.inline{ flex-direction:row; align-items:center; gap:.7rem }
.form-row input[type="number"]{ padding:.45rem .6rem; border:1px solid #ddd; border-radius:.4rem; width:110px }
.chk{ display:flex; align-items:center; gap:.5rem }
.row-actions{ display:flex; align-items:center; gap:.5rem; margin-top:.5rem }

/* Bottom bar */
.bottombar{
  position:sticky; bottom:0; background:#fff; border-top:1px solid #e5e7eb;
  padding:.6rem 1rem; display:flex; align-items:center; justify-content:space-between;
}
.home-link{text-decoration:none; font-weight:700}

/* ---------- FULLSCREEN ENHANCEMENTS ---------- */

/* Fullscreen backdrop */
.app:fullscreen, .app:-webkit-full-screen{
  background:#0a0e18;
}

/* Keep topbar visible (we autohide via class) */
.app:fullscreen .topbar, .app:-webkit-full-screen .topbar{
  position:fixed; top:0; left:0; right:0; z-index:25;
  background:rgba(13,45,92,.88);
  backdrop-filter: blur(6px);
}

/* Hide bottom bar and side panel to maximize space */
.app:fullscreen .bottombar,
.app:-webkit-full-screen .bottombar{
  display:none;
}
.app:fullscreen .side-panel,
.app:-webkit-full-screen .side-panel{
  display:none;
}

/* Single-column layout in fullscreen */
.app:fullscreen .layout,
.app:-webkit-full-screen .layout{
  grid-template-columns: 1fr;
  padding:.6rem;
  margin-top:64px; /* room for topbar */
}

/* Make timers wide and board large */
.app:fullscreen .timers,
.app:-webkit-full-screen .timers{
  width: min(98vw, 1600px);
}
.app:fullscreen .board,
.app:-webkit-full-screen .board{
  width: min(98vw, calc(98vh - 180px));
  max-width: 98vmin;
}

/* --- Soft Landscape Fallback (rotate UI when device is vertical in fullscreen) --- */
.app.fs-rotate{
  position:fixed; inset:0;
  transform: rotate(90deg);
  transform-origin: 50% 50%;
  /* Swap logical width/height after rotate */
  width: 100vh;
  height: 100vw;
  overflow:hidden;
  background:#0a0e18;
}
.app.fs-rotate .layout{
  margin-top:64px;
}
.app.fs-rotate .timers{ width: min(98vh, 1600px); }
.app.fs-rotate .board{
  width: min(98vh, calc(98vw - 180px));
  max-width: 98vmin;
}

/* Responsive */
@media (max-width: 920px){
  .layout{ grid-template-columns: 1fr; }
  .side-panel{ order:2 }
}
