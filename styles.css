:root{
  --blue:#0d2d5c;
  --wood1:#a57a54;
  --wood2:#d3a574;
  --cell-a:#e7cfa6;
  --cell-b:#b88f5a;
  --hi:#84caff;
  --legal:#93e79e;
  --danger:#ff9ba2;
  --ink:#1b1f23;
  --panel:#ffffff;
  --shadow: 0 8px 24px rgba(0,0,0,.12);

  /* new wood board textures */
  --board-light-img:url("assets/board/wood_light.jpg");
  --board-dark-img:url("assets/board/wood_dark.jpg");
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Khmer", Arial, sans-serif;
  color:var(--ink);
  background:#f5f6f7;
}

/* ===== Game App Wrapper ===== */
.app{ min-height:100dvh; display:flex; flex-direction:column }

/* ===== Top bar ===== */
.topbar{
  position:sticky;top:0;z-index:20;
  background:var(--blue); color:#fff;
  display:flex; align-items:center; gap:.5rem;
  padding:.75rem 1rem;
  transition: transform .25s ease, opacity .25s ease;
}
.topbar h1{font-size:1.1rem; margin:0}
.icon-btn{
  background:#fff; color:var(--blue); border:none; border-radius:.75rem;
  padding:.4rem .7rem; font-weight:600; cursor:pointer;
}
.icon-btn:active{transform:translateY(1px)}
.topbar .spacer{flex:1}

/* ===== Layout ===== */
.layout{display:grid;grid-template-columns:1fr 320px;gap:1rem;padding:1rem;flex:1}
.layout.layout-single{grid-template-columns:1fr}
.panel{background:var(--panel);border-radius:1rem;box-shadow:var(--shadow);padding:1rem}
.board-panel{display:flex;flex-direction:column;align-items:center;gap:1rem}

/* ===== Timers ===== */
.timers{width:min(90vw,520px)}
.player-row{
  display:flex;align-items:center;justify-content:space-between;
  background:#fff;border:1px solid #e6e6e6;border-radius:.6rem;
  padding:.4rem .7rem;box-shadow:var(--shadow)
}
.player-name{font-weight:700}
.clock{
  font-variant-numeric:tabular-nums;
  font-weight:800;letter-spacing:.5px;
  padding:.2rem .5rem;border-radius:.4rem;
  background:#0b1220;color:#e6f0ff
}

/* ===== BOARD (3D raised wooden frame) ===== */
.board{
  width: min(90vw, 520px);
  aspect-ratio: 1/1;
  display: grid;
  grid-template-columns: repeat(8, 1fr);
  grid-template-rows: repeat(8, 1fr);
  position: relative;
  border-radius: 20px;
  overflow: hidden;
  box-shadow:
    0 12px 24px rgba(0, 0, 0, 0.35),
    inset 0 0 0 3px rgba(0, 0, 0, 0.25);
  background:
    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.12), transparent 60%),
    linear-gradient(to bottom right, #704c2a, #3b2412);
}

/* Decorative outer wooden frame */
.board::before {
  content: "";
  position: absolute;
  inset: 0;
  background:
    linear-gradient(145deg, #6a3f1a, #3c2410);
  box-shadow:
    inset 0 3px 10px rgba(255,255,255,0.3),
    inset 0 -5px 10px rgba(0,0,0,0.4);
  border-radius: 20px;
  padding: 12px;
  background-clip: content-box;
  pointer-events: none;
}

/* Inner shadow around squares */
.board::after {
  content: "";
  position: absolute;
  inset: 10px;
  border-radius: 14px;
  box-shadow: inset 0 0 18px rgba(0,0,0,0.45);
  pointer-events: none;
}

/* Each cell square */
.cell {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  user-select: none;
  background-size: 256px 256px;
  background-repeat: repeat;
}

/* Use your new seamless wood textures */
.cell.light {
  background-image: var(--board-light-img);
  background-position: center;
  filter: brightness(1.05);
}

.cell.dark {
  background-image: var(--board-dark-img);
  background-position: center;
  filter: brightness(0.9);
}

/* Square labels (A1, H8, etc.) */
.cell::after {
  content: attr(data-ax);
  position: absolute;
  bottom: 5px;
  right: 7px;
  font-size: 0.62rem;
  color: rgba(0,0,0,0.6);
  text-shadow: 1px 1px 2px rgba(255,255,255,0.7);
}

/* Hover / highlight glow */
.cell:hover:not(.selected):not(.hint-capture):not(.hint-move) {
  outline: 2px solid rgba(255, 255, 255, 0.4);
  box-shadow: inset 0 0 10px rgba(255,255,255,0.25);
}

/* Optional subtle 3D tilt when tapping */
.cell:active {
  transform: scale(0.98);
  transition: transform 0.05s;
}

/* ===== Pieces ===== */
.piece{
  width:86%;height:86%;
  background-size:contain;background-repeat:no-repeat;background-position:center;
  border-radius:.4rem;cursor:grab;touch-action:none;
  box-shadow:0 4px 10px rgba(0,0,0,.3);
  transition:transform .1s ease;
}
.piece:active{transform:scale(.96)}

/* ===== Highlights / Hints ===== */
.cell.hint-move::before{
  content:"";position:absolute;width:24%;height:24%;
  background:var(--legal);border-radius:50%;opacity:.8;
}
.cell.hint-capture{outline:3px solid var(--danger)}
.cell.selected{outline:3px solid var(--hi);z-index:1}
.cell:hover:not(.selected):not(.hint-capture):not(.hint-move){
  outline:2px solid rgba(255,255,255,.4);
}

/* ===== Controls ===== */
.controls{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap}
.primary,.secondary{
  padding:.55rem .8rem;border-radius:.6rem;border:none;cursor:pointer;font-weight:600
}
.primary{background:var(--blue);color:#fff}
.secondary{background:#e7edf6}
.turn{margin-left:auto;font-weight:600}

/* ===== Move list ===== */
.moves{margin:0;padding-left:1.2rem;max-height:320px;overflow:auto}

/* ===== Chat panel ===== */
.chat-panel{width:min(90vw,520px)}

/* ===== Bottom nav ===== */
.home-nav{
  position:fixed;left:0;right:0;bottom:0;z-index:50;
  background:#fff;border-top:1px solid #e6e6e6;
  display:grid;grid-template-columns:repeat(5,1fr);gap:.2rem;
  padding:.3rem .3rem calc(.3rem + env(safe-area-inset-bottom));
  box-shadow:0 -6px 20px rgba(0,0,0,.06);
}
.nav-item{
  display:flex;flex-direction:column;align-items:center;gap:.15rem;
  padding:.35rem 0;text-decoration:none;color:#0f172a;border-radius:.6rem;
  font-size:.8rem
}
.nav-item .ni{font-size:1.2rem;line-height:1}
.nav-item.active{background:#eef4ff;color:#0d2d5c;font-weight:800}

/* ===== Portrait-only overlay ===== */
.orientation-blocker{
  position:fixed;inset:0;z-index:9999;
  display:none;align-items:center;justify-content:center;
  background:rgba(0,0,0,.65);color:#fff;text-align:center;
  -webkit-tap-highlight-color:transparent;
}
.orientation-blocker .ob-card{
  background:#0d2d5c;color:#fff;padding:18px 22px;
  border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.3);
  font-weight:800;text-align:center;
}
.orientation-blocker .ob-card small{display:block;font-weight:600;opacity:.85;margin-top:6px}

/* ===== Last move highlight ===== */
.cell.last-from{outline:3px solid rgba(132,202,255,.95);box-shadow:inset 0 0 0 3px rgba(132,202,255,.45)}
.cell.last-to{outline:3px solid rgba(147,231,158,.95);box-shadow:inset 0 0 0 3px rgba(147,231,158,.45)}
.cell.last-capture{animation:capFlash .9s ease-out}
@keyframes capFlash{
  0%{box-shadow:inset 0 0 0 0 rgba(255,0,0,.0),0 0 0 0 rgba(255,0,0,.0)}
  30%{box-shadow:inset 0 0 0 4px rgba(255,0,0,.55),0 0 14px 6px rgba(255,0,0,.25)}
  100%{box-shadow:inset 0 0 0 0 rgba(255,0,0,.0),0 0 0 0 rgba(255,0,0,.0)}
}

/* ===== Responsive ===== */
@media(max-width:920px){
  .layout{grid-template-columns:1fr}
}

/* ===== Scroll-safe bottom spacing ===== */
.app{padding-bottom:76px}

/* ===== Dark theme compatibility ===== */
:root[data-theme="dark"]{
  --ink:#e6f0ff;
}
:root[data-theme="dark"] .board::before{background:radial-gradient(ellipse at center,rgba(255,255,255,.05),transparent 70%)}
