<!doctype html>
<html lang="km">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,maximum-scale=1,user-scalable=no" />
  <title>á¢á»á€á…ááŸ’ášá„áŸ’á‚ (Khmer Chess)</title>

  <!-- Font -->
  <link rel="preload" as="font" href="assets/fonts/Krasar-Regular.ttf" type="font/ttf" crossorigin>

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#0d2d5c" />
  <meta name="screen-orientation" content="portrait">
  <meta name="x5-orientation" content="portrait">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <script src="js/pwa.js" defer></script>

  <!-- Board textures -->
  <style>
    :root{
      --board-light-img: url("assets/board/wood_light.jpg");
      --board-dark-img:  url("assets/board/wood_dark.jpg");
    }

    /* === spinner for AI thinking === */
    .ai-thinking {
      position: fixed; inset: 0; display: none;
      align-items: center; justify-content: center;
      background: rgba(0,0,0,.35); z-index: 9999;
      -webkit-backdrop-filter: blur(1px); backdrop-filter: blur(1px);
    }
    .ai-card{
      min-width: 180px; padding: 14px 16px; border-radius: 12px;
      background:#101826; color:#fff; text-align:center; font-family: Krasar, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      box-shadow: 0 8px 24px rgba(0,0,0,.35);
    }
    .ai-spinner{
      width: 28px; height: 28px; margin: 0 auto 8px; border-radius: 50%;
      border: 3px solid rgba(255,255,255,.25); border-top-color:#fff;
      animation: ai-spin .8s linear infinite;
    }
    @keyframes ai-spin { to { transform: rotate(360deg); } }
  </style>

  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div id="app" class="app">
    <main class="layout layout-single">
      <section class="panel board-panel">

        <!-- Turn + counting draw -->
        <div class="turn-wrap">
          <div id="turnLabel" class="turn-banner">áœáŸá“áá¶á„ (áŸ)</div>

          <span id="count-label" class="count-label" style="display:none;">
            â³ <b>ášá¶á”áŸ‹áŸáŸ’á˜á¾áŸ– <span id="count-number">â€“</span></b>
          </span>
          <div id="count-bar" class="count-bar" style="display:none;">
            <div id="count-bar-fill" class="count-bar-fill"></div>
            <span id="count-badge" class="count-badge">â€“</span>
          </div>

          <audio id="snd-count-start" preload="auto" src="assets/sfx/count-start.mp3"></audio>
          <audio id="snd-count-end"   preload="auto" src="assets/sfx/count-end.mp3"></audio>
        </div>

        <!-- Controls -->
        <div class="controls controls-top">
          <button id="btnReset" class="btn-icon primary" title="á…á¶á”áŸ‹á•áŸ’áŠá¾á˜ááŸ’á˜á¸">
            <img src="assets/ui/reset.png" width="22" height="22" alt="">
            <span>á…á¶á”áŸ‹á•áŸ’áŠá¾á˜ááŸ’á˜á¸</span>
          </button>

          <button id="btnPause" class="btn-icon secondary" title="Pause/Resume">
            <img src="assets/ui/pause.png" width="22" height="22" alt="">
            <span>á•áŸ’á¢á¶á€</span>
          </button>

          <button id="btnUndo" class="btn-icon secondary" title="áá™á€áŸ’ášáŸ„á™">
            <img src="assets/ui/undo.png" width="22" height="22" alt="">
            <span>áá™á€áŸ’ášáŸ„á™</span>
          </button>
        </div>

        <!-- Top clock -->
        <div class="timers">
          <div class="player-row top">
            <div class="player-name">ááŸ’á˜áŸ… (Black)</div>
            <div class="clock" id="clockB">10:00.0</div>
          </div>
        </div>

        <!-- Board -->
        <div id="board" class="board board-wood no-coords" aria-label="Khmer Chess Board"></div>

        <!-- Bottom clock -->
        <div class="timers">
          <div class="player-row bottom">
            <div class="player-name">áŸ (White)</div>
            <div class="clock" id="clockW">10:00.0</div>
          </div>
        </div>

        <!-- Chat placeholder -->
        <section class="panel card chat-panel card-full">
          <div class="card-left">
            <div class="card-title">áŸá“áŸ’á‘á“á¶ (Chat)</div>
            <div class="card-sub">coming soon</div>
          </div>
        </section>

      </section>
    </main>

    <!-- Bottom nav -->
    <footer id="appTabbar" class="bottom-bar">
      <a class="nav-item" href="index.html"><img class="ni-img" src="assets/ui/nav-home.png" alt=""><span>Home</span></a>
      <a class="nav-item" href="friends.html"><img class="ni-img" src="assets/ui/nav-friends.png" alt=""><span>Friend</span></a>
      <a class="nav-item active" href="play.html" aria-current="page"><img class="ni-img" src="assets/ui/nav-play.png" alt=""><span>Play</span></a>
      <a class="nav-item" href="settings.html"><img class="ni-img" src="assets/ui/nav-settings.png" alt=""><span>Setting</span></a>
      <a class="nav-item" href="notifications.html"><img class="ni-img" src="assets/ui/nav-bell.png" alt=""><span>Notification</span></a>
    </footer>
    <div id="bottomSpacer" aria-hidden="true"></div>
  </div>

  <!-- Portrait-only overlay -->
  <div class="orientation-blocker" id="orientationBlock" aria-hidden="true">
    <div class="ob-card">
      áŸá¼á˜á”áŸ’ášá¾á‘á˜áŸ’ášá„áŸ‹á”á‰áŸ’áˆáš<br/>
      <small>Rotate back to portrait to continue</small>
    </div>
  </div>

  <!-- AI thinking overlay -->
  <div class="ai-thinking" id="aiThinking">
    <div class="ai-card">
      <div class="ai-spinner"></div>
      <div>ğŸ¤– á€áŸ†á–á»á„á‚á·áâ€¦</div>
    </div>
  </div>

  <!-- JS (no debug.js, no engine-pro.js) -->
  <script type="module" src="./js/main.js"></script>

  <!-- expose tiny helpers for spinner (used by ai.js automatically) -->
  <script>
    window.__aiShow = () => { const el = document.getElementById('aiThinking'); if (el) el.style.display='flex'; };
    window.__aiHide = () => { const el = document.getElementById('aiThinking'); if (el) el.style.display='none'; };
  </script>
</body>
</html>
