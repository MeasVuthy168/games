<!doctype html>
<html lang="km">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,maximum-scale=1,user-scalable=no" />
  <title>á¢á»á€á…ááŸ’ášá„áŸ’á‚ (Khmer Chess)</title>

  <!-- Khmer Font -->
  <style>
    @font-face{
      font-family:"Krasar";
      src:url("assets/fonts/Krasar-Regular.ttf") format("truetype");
      font-weight:400; font-style:normal; font-display:swap;
    }
    @font-face{
      font-family:"Krasar";
      src:url("assets/fonts/Krasar-Regular.ttf") format("truetype");
      font-weight:700; font-style:normal; font-display:swap;
    }
    :root{
      --ui-font:"Krasar","Noto Sans Khmer",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      --blue:#0d2d5c;
    }
    html,body,.home-app,.home-app *{ font-family:var(--ui-font); }
  </style>

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#0d2d5c" />
  <link rel="apple-touch-icon" href="assets/icons/icon-192.png" />
  <script src="js/pwa.js" defer></script>
  <link rel="stylesheet" href="styles.css" />

  <style>
    .menu-grid{ display:grid; grid-template-columns:repeat(2,1fr); gap:1rem; padding:1rem; }
    .menu-card{
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      background:#fff; padding:1rem; border-radius:1rem; text-decoration:none; color:#0d2d5c;
      box-shadow:0 4px 12px rgba(0,0,0,.08); font-weight:700; cursor:pointer; font-size:1.05rem;
    }
    .menu-card:active{ transform:scale(.98) }
    .card-emoji{ font-size:2.2rem; margin-bottom:.4rem }
    .avatar{ width:36px; height:36px; border-radius:50%; object-fit:cover }
    .pill{
      display:inline-block; padding:.12rem .5rem; border-radius:999px;
      background:#eef4ff; color:#0d2d5c; font-weight:800; font-size:.86rem; margin-inline-start:.35rem;
    }
    .install-btn{ display:none }
  </style>
</head>
<body>
  <div class="app home-app">
    <!-- Top bar -->
    <header class="topbar">
      <h1>á¢á»á€á…ááŸ’ášá„áŸ’á‚ (Khmer Chess)</h1>
      <div class="spacer"></div>
      <a href="settings.html" class="avatar-link" title="Setting">
        <img src="assets/icons/icon-192.png" alt="user" class="avatar" />
      </a>
    </header>

    <!-- Main -->
    <main class="home-main">
      <button id="installBtn" class="install-btn">ğŸ“² á’áŸ’áœá¾á€á¶ášááŸ†á¡á¾á„á€á˜áŸ’á˜áœá·á’á¸ (Install App)</button>

      <div class="menu-grid">
        <!-- Only one level: Master -->
        <button id="btnVsAI" class="menu-card" type="button">
          <div class="card-emoji">ğŸ¤–</div>
          <span>á›áŸá„á‡á¶á˜á½á™ AI (Master)</span>
          <small id="aiLast" class="last-choice" style="display:none"></small>
        </button>

        <a id="btnFriend" class="menu-card" href="play.html?mode=friend">
          <div class="card-emoji">ğŸ‘¥</div>
          <span>á›áŸá„á‡á¶á˜á½á™á˜á·ááŸ’á</span>
        </a>
      </div>
    </main>

    <!-- Bottom navigation -->
    <footer id="appTabbar" class="bottom-bar">
      <a class="nav-item active" href="index.html" aria-current="page">
        <img class="ni-img" src="assets/ui/nav-home.png" alt=""><span>Home</span>
      </a>
      <a class="nav-item" href="friends.html">
        <img class="ni-img" src="assets/ui/nav-friends.png" alt=""><span>Friend</span>
      </a>
      <a class="nav-item" href="play.html">
        <img class="ni-img" src="assets/ui/nav-play.png" alt=""><span>Play</span>
      </a>
      <a class="nav-item" href="settings.html">
        <img class="ni-img" src="assets/ui/nav-settings.png" alt=""><span>Setting</span>
      </a>
      <a class="nav-item" href="notifications.html">
        <img class="ni-img" src="assets/ui/nav-bell.png" alt=""><span>Notification</span>
      </a>
    </footer>
    <div id="bottomSpacer" aria-hidden="true"></div>
  </div>

  <script>
    /* Bottom bar spacer + active state */
    (function(){
      const bar = document.getElementById('appTabbar');
      const spacer = document.getElementById('bottomSpacer');
      if(bar && spacer){
        function setSpacer(){
          const h = bar.offsetHeight || 56;
          spacer.style.height = `calc(${h}px + env(safe-area-inset-bottom))`;
        }
        if(document.readyState === 'complete') setSpacer();
        else window.addEventListener('load', setSpacer, {once:true});
        window.addEventListener('resize', setSpacer, {passive:true});
        const here = location.pathname.split('/').pop() || 'index.html';
        for(const a of bar.querySelectorAll('a')){
          if((a.getAttribute('href')||'').endsWith(here)) a.classList.add('active');
          else a.classList.remove('active');
        }
      }
    })();

    /* Settings helpers */
    const LS_KEY='kc_settings_v1';
    function loadSettings(){ try{ return JSON.parse(localStorage.getItem(LS_KEY)||'null')||{} }catch{ return {} } }
    function saveSettings(s){ localStorage.setItem(LS_KEY, JSON.stringify(s)); }

    /* Show last Master choice (who is White) */
    (function showLastChoice(){
      const s = loadSettings();
      if(!s || !s.aiEnabled) return;
      const wrap = document.getElementById('aiLast');
      const who = (s.aiColor === 'w') ? 'AI (White)' : 'ááŸ’á‰á»áŸ† (White)';
      wrap.style.display = 'block';
      wrap.innerHTML = 'á€áŸ†áááŸ‹á…á»á„á€áŸ’ášáŸ„á™áŸ– Master <span class="pill">' + who + '</span>';
    })();

    /* One-button Master */
    document.getElementById('btnVsAI').addEventListener('click', ()=>{
      const s = loadSettings();
      s.aiEnabled = true;
      // default: user plays White, AI Black. Toggle if you want opposite:
      s.aiColor = 'b'; // AI color relative to "who is White": if you want AI White, set 'w'
      saveSettings(s);
      location.href = 'play.html?mode=ai';
    });

    document.getElementById('btnFriend').addEventListener('click', ()=>{
      const s = loadSettings(); s.aiEnabled=false; saveSettings(s);
    });
  </script>
</body>
</html>
